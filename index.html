<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do App - Test Suite</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 20px;
        }
        h1 { color: #333; }
        #test-results {
            list-style-type: none;
            padding: 0;
            font-family: monospace;
        }
        .test-result {
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 5px;
            border-left-width: 5px;
            border-left-style: solid;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }
        /* This div holds the app's HTML for testing but is not visible on the page */
        #test-fixture {
            display: none;
        }
    </style>
</head>
<body>

    <h1>To-Do App - Test Suite</h1>
    <ul id="test-results"></ul>

    <!-- The application's HTML structure, required for the script to work -->
    <div id="test-fixture">
        <div class="input-form">
            <input type="text" id="task-input" placeholder="Add a new task...">
            <input type="date" id="date-input">
            <button id="add-task-btn">Add</button>
        </div>
        <ul id="task-list"></ul>
    </div>

    <!-- The application's original JavaScript logic -->
    <script id="app-logic">
        // This is a direct copy of the script from index.html
        document.addEventListener('DOMContentLoaded', () => {
            const taskInput = document.getElementById('task-input');
            const addTaskBtn = document.getElementById('add-task-btn');
            const dateInput = document.getElementById('date-input');
            const taskList = document.getElementById('task-list');

            const addTask = () => {
                const taskText = taskInput.value.trim();
                const dueDateValue = dateInput.value;

                if (taskText === '') {
                    alert('Please enter a task.');
                    return;
                }

                const li = document.createElement('li');
                let dueDateHTML = '';

                if (dueDateValue) {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    const [year, month, day] = dueDateValue.split('-').map(Number);
                    const dueDate = new Date(year, month - 1, day);

                    if (dueDate < today) {
                        li.classList.add('overdue');
                    }

                    const formattedDate = dueDate.toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric'
                    });

                    dueDateHTML = `<span class="due-date">Due: ${formattedDate}</span>`;
                }

                li.innerHTML = `
                    <div class="task-details">
                        <span class="task-text">${taskText}</span>
                        ${dueDateHTML}
                    </div>
                    <button class="delete-btn">X</button>`;
                taskList.appendChild(li);

                taskInput.value = '';
                dateInput.value = '';
                taskInput.focus();
            };

            addTaskBtn.addEventListener('click', addTask);

            taskInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    addTask();
                }
            });

            taskList.addEventListener('click', (event) => {
                const target = event.target;
                if (target.classList.contains('delete-btn')) {
                    const li = target.parentElement;
                    taskList.removeChild(li);
                } else if (target.closest('li')) {
                    const li = target.closest('li');
                    li.classList.toggle('completed');
                }
            });
        });
    </script>

    <!-- Test Runner and Test Cases -->
    <script id="test-runner">
        document.addEventListener('DOMContentLoaded', () => {
            const testResultsList = document.getElementById('test-results');
            const taskInput = document.getElementById('task-input');
            const dateInput = document.getElementById('date-input');
            const addTaskBtn = document.getElementById('add-task-btn');
            const taskList = document.getElementById('task-list');

            let originalAlert;
            let alertCalled;

            // A simple assertion function
            const assert = (condition, message) => {
                if (!condition) {
                    throw new Error(message || "Assertion failed");
                }
            };

            // A helper to run a single test and report its result
            const runTest = (name, testFn) => {
                const li = document.createElement('li');
                li.classList.add('test-result');
                try {
                    // Setup before each test
                    taskList.innerHTML = '';
                    taskInput.value = '';
                    dateInput.value = '';
                    alertCalled = false;
                    originalAlert = window.alert;
                    window.alert = () => { alertCalled = true; };

                    // Run the test
                    testFn();

                    // Report pass
                    li.textContent = `✅ PASS: ${name}`;
                    li.classList.add('pass');
                } catch (e) {
                    // Report fail
                    li.textContent = `❌ FAIL: ${name} | ${e.message}`;
                    li.classList.add('fail');
                    console.error(`Test failed: ${name}`, e);
                } finally {
                    // Teardown after each test
                    window.alert = originalAlert;
                    testResultsList.appendChild(li);
                }
            };

            // --- Test Suite ---

            // --- Pass Conditions ---
            runTest('should add a new task to the list', () => {
                taskInput.value = 'My first task';
                addTaskBtn.click();
                assert(taskList.children.length === 1, 'Task list should have one item.');
                assert(taskList.querySelector('.task-text').textContent === 'My first task', 'Task text is incorrect.');
            });

            runTest('should add a task with a due date', () => {
                taskInput.value = 'Task with a date';
                dateInput.value = '2099-12-31';
                addTaskBtn.click();
                const dueDateEl = taskList.querySelector('.due-date');
                assert(dueDateEl !== null, 'Due date element should exist.');
                assert(dueDateEl.textContent === 'Due: Dec 31', 'Due date text is incorrect.');
            });

            runTest('should mark a task as overdue if the date is in the past', () => {
                taskInput.value = 'Overdue task';
                dateInput.value = '2000-01-01';
                addTaskBtn.click();
                const taskItem = taskList.querySelector('li');
                assert(taskItem.classList.contains('overdue'), 'Task should have the "overdue" class.');
            });

            runTest('should mark a task as completed on click', () => {
                taskInput.value = 'Task to complete';
                addTaskBtn.click();
                const taskItem = taskList.querySelector('li');
                taskItem.click();
                assert(taskItem.classList.contains('completed'), 'Task should have the "completed" class after click.');
            });

            runTest('should toggle completion status on second click', () => {
                taskInput.value = 'Task to toggle';
                addTaskBtn.click();
                const taskItem = taskList.querySelector('li');
                taskItem.click(); // First click: complete
                taskItem.click(); // Second click: un-complete
                assert(!taskItem.classList.contains('completed'), 'Task should not have "completed" class after second click.');
            });

            runTest('should delete a task when the delete button is clicked', () => {
                taskInput.value = 'Task to delete';
                addTaskBtn.click();
                assert(taskList.children.length === 1, 'Task should be present before deletion.');
                taskList.querySelector('.delete-btn').click();
                assert(taskList.children.length === 0, 'Task list should be empty after deletion.');
            });

            // --- Failure Conditions ---
            runTest('should NOT add an empty task and should show an alert', () => {
                taskInput.value = '   '; // Empty space
                addTaskBtn.click();
                assert(taskList.children.length === 0, 'Task list should remain empty.');
                assert(alertCalled === true, 'An alert should have been triggered for empty input.');
            });
        });
    </script>

</body>
</html>


